# 10.12 Delivery Plan

This document outlines the 7-phase implementation roadmap for Homebot using the Ralph Wiggum autonomous development methodology.

---

## Overview

Each phase is designed to be executed as a series of Ralph tasks with testable criteria. Phases build on each other but aim for functional milestones at each stage.

| Phase | Focus | Key Milestone |
|-------|-------|---------------|
| 1 | Foundation | Running skeleton with auth |
| 2 | Inventory Core | Basic scan-to-add workflow |
| 3 | Device & UI | Vue/Quasar tablet interface |
| 4 | Labels & QR | QR routing, label printing |
| 5 | Recipes & Lists | Meal planning, shopping |
| 6 | Intelligence | Food analysis, cost tracking |
| 7 | Documents | Paperless integration, returns |

---

## Phase 1: Foundation

**Goal:** Establish core infrastructure with multi-tenant support.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 1.1 | PostgreSQL schema with tenant tables and RLS policies | [CRITICAL] |
| 1.2 | FastAPI project structure with v2 API scaffold | [CRITICAL] |
| 1.3 | User authentication (JWT tokens, session management) | [CRITICAL] |
| 1.4 | Tenant middleware sets `app.tenant_id` in DB session | [CRITICAL] |
| 1.5 | Alembic migrations for core tables | [CORE] |
| 1.6 | Redis connection for caching/sessions | [CORE] |
| 1.7 | Docker Compose development environment | [CORE] |
| 1.8 | Basic health check and info endpoints | [CORE] |
| 1.9 | Structured logging with tenant context | [FLEX] |
| 1.10 | OpenTelemetry instrumentation scaffold | [FLEX] |

### Deliverables
- Running FastAPI application on port 3334
- PostgreSQL with RLS-protected tables
- User can register, login, create/join tenant
- Docker Compose for local development

---

## Phase 2: Inventory Core

**Goal:** Basic inventory management with barcode scanning.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 2.1 | Product model with tenant isolation | [CRITICAL] |
| 2.2 | Location model with hierarchy (closure table) | [CRITICAL] |
| 2.3 | Stock/inventory tracking model | [CRITICAL] |
| 2.4 | Barcode validation and normalization | [CRITICAL] |
| 2.5 | OpenFoodFacts lookup provider | [CORE] |
| 2.6 | Multi-provider lookup manager | [CORE] |
| 2.7 | LLM integration for name optimization | [CORE] |
| 2.8 | Product CRUD API endpoints | [CORE] |
| 2.9 | Stock add/consume/transfer API | [CORE] |
| 2.10 | go-upc and UPCItemDB providers | [FLEX] |
| 2.11 | Brave Search fallback provider | [FLEX] |
| 2.12 | Redis caching for lookups | [FLEX] |

### Deliverables
- Scan barcode → lookup → create product
- Add stock to location with expiration date
- Consume/transfer stock between locations

---

## Phase 3: Device & UI

**Goal:** Vue.js/Quasar frontend optimized for tablet use.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 3.1 | Vue 3 + Quasar project scaffold | [CRITICAL] |
| 3.2 | Pinia store for auth and tenant state | [CRITICAL] |
| 3.3 | Login/registration pages | [CRITICAL] |
| 3.4 | Tenant selection/switching UI | [CRITICAL] |
| 3.5 | Main scanning page with camera support | [CRITICAL] |
| 3.6 | Product review/edit dialog | [CORE] |
| 3.7 | Location browser with hierarchy | [CORE] |
| 3.8 | Device registration and preferences API | [CORE] |
| 3.9 | Keyboard wedge scanner support | [CORE] |
| 3.10 | Touch-friendly date picker | [CORE] |
| 3.11 | PWA configuration for offline shell | [FLEX] |
| 3.12 | Capacitor native build setup | [FLEX] |

### Deliverables
- Tablet-optimized scanning interface
- Device remembers preferences (default location, action mode)
- Works with USB barcode scanners

---

## Phase 4: Labels & QR

**Goal:** QR routing system and label printing.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 4.1 | QR token model with namespaces | [CRITICAL] |
| 4.2 | Crockford Base32 encoding with checksum | [CRITICAL] |
| 4.3 | QR routing endpoint (`/q/{code}`) | [CRITICAL] |
| 4.4 | Token assignment to products/locations/instances | [CRITICAL] |
| 4.5 | Brother QL printer integration | [CORE] |
| 4.6 | Label template system | [CORE] |
| 4.7 | Label designer UI (basic) | [CORE] |
| 4.8 | Batch label printing | [CORE] |
| 4.9 | QR scanning distinguishes product vs location | [CORE] |
| 4.10 | Webhook-based print triggers | [FLEX] |
| 4.11 | Advanced label designer with drag-drop | [FUTURE] |

### Deliverables
- Print QR labels for products and locations
- Scan QR → routes to correct item
- Cross-tenant QR scanning shows prompt

---

## Phase 5: Recipes & Lists

**Goal:** Meal planning and shopping list management.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 5.1 | Recipe model with ingredients | [CRITICAL] |
| 5.2 | Meal plan model (calendar-based) | [CRITICAL] |
| 5.3 | Shopping list model | [CRITICAL] |
| 5.4 | Recipe CRUD UI | [CORE] |
| 5.5 | Meal plan calendar UI | [CORE] |
| 5.6 | "What can I make?" inventory check | [CORE] |
| 5.7 | Auto-generate shopping list from meal plan | [CORE] |
| 5.8 | Shopping list UI with check-off | [CORE] |
| 5.9 | Recipe scaling (servings) | [FLEX] |
| 5.10 | Recipe import from URL | [FLEX] |
| 5.11 | Grocy recipe compatibility | [FUTURE] |

### Deliverables
- Create recipes with ingredient requirements
- Plan meals on calendar
- Generate and manage shopping lists

---

## Phase 6: Intelligence

**Goal:** Food analysis, cost tracking, and smart features.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 6.1 | Custom attributes system (JSONB) | [CRITICAL] |
| 6.2 | Attribute definitions API | [CRITICAL] |
| 6.3 | Store model for purchase tracking | [CORE] |
| 6.4 | Purchase/receipt model | [CORE] |
| 6.5 | Dollar Cost Averaging calculation | [CORE] |
| 6.6 | LPN (License Plate Number) instance tracking | [CORE] |
| 6.7 | Instance remaining units (pills, etc.) | [CORE] |
| 6.8 | Ingredient parsing from product data | [FLEX] |
| 6.9 | Processing concern flagging (seed oils, etc.) | [FLEX] |
| 6.10 | Food safety guidelines lookup | [FLEX] |
| 6.11 | Price history charts | [FUTURE] |

### Deliverables
- Track costs per product with DCA
- Instance-level tracking for specific items
- Custom attributes on any entity

---

## Phase 7: Documents

**Goal:** Paperless-ngx integration and return tracking.

### Criteria

| ID | Criterion | Tag |
|----|-----------|-----|
| 7.1 | Paperless-ngx Docker Compose integration | [CRITICAL] |
| 7.2 | Receipt document type in Paperless | [CRITICAL] |
| 7.3 | Link receipts to purchases | [CORE] |
| 7.4 | Return tracking state machine | [CORE] |
| 7.5 | Store return policy model | [CORE] |
| 7.6 | Return deadline notifications | [CORE] |
| 7.7 | OCR receipt parsing for line items | [FLEX] |
| 7.8 | Auto-match receipts to purchases | [FLEX] |
| 7.9 | Grafana observability stack | [FLEX] |
| 7.10 | Full Grocy API compatibility layer | [FUTURE] |

### Deliverables
- Upload receipts → linked to purchases
- Track return deadlines with notifications
- Full observability dashboards

---

## Phase Dependencies

```
Phase 1 (Foundation)
    ↓
Phase 2 (Inventory) ←──────┐
    ↓                      │
Phase 3 (Device & UI)      │
    ↓                      │
Phase 4 (Labels & QR) ─────┤
    ↓                      │
Phase 5 (Recipes) ─────────┤
    ↓                      │
Phase 6 (Intelligence) ────┘
    ↓
Phase 7 (Documents)
```

---

## Criticality Tags

| Tag | Meaning | Phase Gate |
|-----|---------|------------|
| `[CRITICAL]` | Must work for phase to complete | Blocking |
| `[CORE]` | Expected functionality | Should complete |
| `[FLEX]` | Nice to have | Can defer |
| `[FUTURE]` | Planned for later | Skip in phase |

---

## Risk Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| LLM API rate limits | Delayed optimization | Local caching, queue retry |
| Grocy compat complexity | Scope creep | Defer to [FUTURE], focus on v2 API |
| Multi-tenant bugs | Data leaks | Extensive RLS testing, audit logs |
| Label printer variety | Hardware support | Start with Brother QL only |
| Paperless-ngx changes | Integration breaks | Version pin, API abstraction |

---

## Target Server

All phases deploy to:

| Property | Value |
|----------|-------|
| **Host** | `192.168.200.37` |
| **SSH** | `root@192.168.200.37` |
| **Install Path** | `/opt/homebot/` |
| **Service** | `homebot` (systemd) |

---

## Navigation

- **Previous:** [Executive Summary](10.11-executive-summary.md)
- **Next:** [User Stories](20.10-user-stories.md)
- **Back to:** [README](README.md)
