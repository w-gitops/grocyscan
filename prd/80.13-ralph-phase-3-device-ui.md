# 80.13 Ralph Phase 3: Device & UI

This is the Ralph Wiggum task document for Phase 3 - Device management and Vue/Quasar UI.

> **Current Implementation Note:** The codebase currently uses **NiceGUI** (Python, server-rendered) as an interim UI served by FastAPI on port 3334. This phase describes the **target architecture** (Vue 3 + Quasar PWA on port 3335). Phase 3 can be executed in two ways:
>
> 1. **Option A (Recommended):** Validate device preferences and scanning with the existing NiceGUI UI at `http://localhost:3334`, then build the Vue/Quasar frontend as a separate milestone.
> 2. **Option B:** Build Vue/Quasar frontend from scratch per this spec, replacing NiceGUI.
>
> See [DEC-051](91.14-decision-log.md#dec-051-ui-stack-and-pwa-alignment) for details.

---

## Frontmatter

```yaml
phase: 3
name: Device & UI
description: Vue/Quasar frontend, device preferences, tablet-first interface
test_command: npm run test && pytest tests/phase3/ -v
browser_validation: true
browser_url: http://localhost:3334  # Current: NiceGUI; Target: http://localhost:3335 (Vue)
estimated_criteria: 12
```

---

## Overview

Phase 3 builds the user interface:

- Vue 3 + Quasar frontend scaffold (target architecture)
- Device registration and preferences
- Tablet-optimized scanning interface
- Action mode selection (Add, Consume, Transfer)
- PWA configuration (manifest, service worker, offline support)

---

## Acceptance Criteria

### Frontend Scaffold

- [ ] **[1] [CRITICAL]** Vue 3 + Quasar project initialized
  - Test: `npm run dev` starts dev server
  - BrowserMCP: Navigate to http://localhost:3335 (Vue target) or http://localhost:3334 (NiceGUI current), page loads

- [ ] **[2] [CRITICAL]** Pinia store configured
  - Test: Auth store manages login state
  - Test: User store persists across refresh

- [ ] **[3] [CORE]** Router with auth guards
  - Test: Unauthenticated users redirected to login
  - Test: Deep links work after login

### Device Management

- [ ] **[4] [CRITICAL]** Device registration on first visit
  - BrowserMCP: Visit app, device registration prompt appears
  - Test: `POST /api/v2/devices` creates device record

- [ ] **[5] [CRITICAL]** Device preferences stored
  - Test: Default location saved to device
  - Test: Default action mode persisted

- [ ] **[6] [CORE]** Device fingerprinting
  - Test: Same device recognized across sessions
  - Test: Different devices get unique IDs

### Scanning Interface

- [ ] **[7] [CRITICAL]** Camera barcode scanner works
  - BrowserMCP: Click scan button, camera activates
  - BrowserMCP: Scan barcode image, product lookup triggered

- [ ] **[8] [CRITICAL]** Action mode selection
  - BrowserMCP: Select "Add Stock" mode
  - BrowserMCP: Scan barcode, add stock dialog appears

- [ ] **[9] [CORE]** Quick actions after scan
  - BrowserMCP: Scan known product, quick add buttons visible
  - BrowserMCP: Click "+1", stock increased

### Product Views

- [ ] **[10] [CORE]** Product list with search
  - BrowserMCP: Type in search, results filter
  - BrowserMCP: Click product, detail view opens

- [ ] **[11] [CORE]** Product detail view
  - BrowserMCP: View shows stock levels, locations
  - BrowserMCP: Edit button opens edit form

- [ ] **[12] [FLEX]** PWA installable
  - BrowserMCP: Install prompt appears on mobile
  - Test: Service worker registered

---

## Test Command

```bash
# Frontend tests
cd frontend && npm run test

# Backend API tests for device endpoints
pytest tests/phase3/ -v --tb=short

# E2E tests with BrowserMCP
# Run manually during development
```

---

## Dependencies

- Phase 1 complete (auth)
- Phase 2 complete (products, stock)

---

## Files to Create/Modify

```
frontend/
├── package.json
├── quasar.config.js
├── src/
│   ├── App.vue
│   ├── router/
│   │   └── index.ts         # Routes + guards
│   ├── stores/
│   │   ├── auth.ts          # Auth state
│   │   ├── device.ts        # Device prefs
│   │   └── products.ts      # Product cache
│   ├── pages/
│   │   ├── LoginPage.vue
│   │   ├── ScanPage.vue     # Main scanning UI
│   │   ├── ProductsPage.vue
│   │   └── ProductDetail.vue
│   ├── components/
│   │   ├── BarcodeScanner.vue
│   │   ├── ActionModeSelector.vue
│   │   ├── QuickActions.vue
│   │   └── ProductCard.vue
│   └── services/
│       ├── api.ts           # API client
│       └── device.ts        # Device fingerprint

app/
├── models/
│   └── device.py
├── api/routes/
│   └── devices.py
└── schemas/
    └── device.py

migrations/versions/
└── 005_devices.py

tests/phase3/
├── test_devices.py
└── test_device_api.py
```

---

## BrowserMCP Validation Checklist

```markdown
# Use localhost:3334 for current NiceGUI; localhost:3335 for Vue target
1. [ ] App loads at localhost:3334 (or :3335)
2. [ ] Login form accepts credentials
3. [ ] Device registration modal appears
4. [ ] Scan button activates camera
5. [ ] Action mode dropdown works
6. [ ] Product search filters list
7. [ ] Product detail shows stock
```

---

## Navigation

- **Previous:** [Phase 2: Inventory Core](80.12-ralph-phase-2-inventory.md)
- **Next:** [Phase 4: Labels & QR](80.14-ralph-phase-4-labels-qr.md)
- **Back to:** [README](README.md)
