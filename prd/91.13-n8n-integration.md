# 91.13 n8n Integration

## 91.13.1 Overview

Homebot provides two n8n community nodes:
1. **Homebot Node** - Regular node for workflow automation
2. **Homebot Tool** - AI Agent tool for intelligent automation

## 91.13.2 Node Package Structure

```
n8n-nodes-homebot/
├── package.json
├── credentials/
│   └── HomebotApi.credentials.ts
├── nodes/
│   └── Homebot/
│       ├── Homebot.node.ts       # Regular node
│       ├── HomebotTool.node.ts   # AI Agent tool
│       ├── GenericFunctions.ts
│       └── descriptions/
│           ├── ScanDescription.ts
│           ├── ProductDescription.ts
│           ├── LocationDescription.ts
│           └── RecipeDescription.ts
└── icons/
    └── homebot.svg
```

## 91.13.3 Credentials

```typescript
// credentials/HomebotApi.credentials.ts
export class HomebotApi implements ICredentialType {
  name = 'homebotApi';
  displayName = 'Homebot API';
  
  properties: INodeProperties[] = [
    {
      displayName: 'Base URL',
      name: 'baseUrl',
      type: 'string',
      default: 'http://localhost:3334',
    },
    {
      displayName: 'API Token',
      name: 'apiToken',
      type: 'string',
      typeOptions: { password: true },
    },
  ];

  authenticate: IAuthenticateGeneric = {
    type: 'generic',
    properties: {
      headers: { 'Authorization': 'Bearer ={{$credentials.apiToken}}' },
    },
  };
}
```

## 91.13.4 Regular Node Operations

### Scan Resource
- **Lookup** - Look up product by barcode
- **Add to Inventory** - Scan and add product
- **Batch Lookup** - Multiple barcodes at once

### Product Resource
- **Get All** - List products
- **Get** - Get by ID
- **Search** - Search by name
- **Create** - Create new product
- **Get Expiring** - Products expiring soon

### Location Resource
- **Get All** - List locations
- **Get** - Get by ID
- **Create** - Create location

### Recipe Resource
- **Get All** - List recipes
- **Get Cookable** - Recipes with available ingredients
- **Generate Shopping List** - From meal plan

### Shopping List Resource
- **Get All** - List shopping lists
- **Create** - Create new list
- **Add Items** - Add items to list

## 91.13.5 AI Agent Tool

```typescript
// HomebotTool.node.ts
export class HomebotTool implements INodeType {
  description: INodeTypeDescription = {
    displayName: 'Homebot Tool',
    name: 'homebotTool',
    group: ['transform'],
    codex: {
      categories: ['AI'],
      subcategories: { AI: ['Tools'] },
    },
    inputs: [],
    outputs: [NodeConnectionType.AiTool],
    properties: [
      {
        displayName: 'Available Tools',
        name: 'availableTools',
        type: 'multiOptions',
        default: ['lookupBarcode', 'searchProducts', 'getExpiringProducts'],
        options: [
          { name: 'Lookup Barcode', value: 'lookupBarcode' },
          { name: 'Search Products', value: 'searchProducts' },
          { name: 'Add to Inventory', value: 'addToInventory' },
          { name: 'Get Expiring Products', value: 'getExpiringProducts' },
          { name: 'List Locations', value: 'listLocations' },
          { name: 'Get Cookable Recipes', value: 'getCookableRecipes' },
          { name: 'Log Consumption', value: 'logConsumption' },
        ],
      },
    ],
  };
}
```

## 91.13.6 Example Workflows

### Daily Expiration Alert

```json
{
  "name": "Homebot Daily Expiration Alert",
  "nodes": [
    {
      "name": "Daily at 8am",
      "type": "n8n-nodes-base.scheduleTrigger",
      "parameters": {
        "rule": { "interval": [{ "field": "hours", "hour": 8 }] }
      }
    },
    {
      "name": "Get Expiring Products",
      "type": "n8n-nodes-homebot.homebot",
      "parameters": {
        "resource": "product",
        "operation": "getExpiring",
        "days": 7
      }
    },
    {
      "name": "Send Email Alert",
      "type": "n8n-nodes-base.emailSend",
      "parameters": {
        "subject": "Items expiring soon"
      }
    }
  ]
}
```

### Return Deadline Reminder

```json
{
  "name": "Homebot Return Deadline Reminder",
  "nodes": [
    {
      "name": "Daily at 9am",
      "type": "n8n-nodes-base.scheduleTrigger",
      "parameters": {
        "rule": { "interval": [{ "field": "hours", "hour": 9 }] }
      }
    },
    {
      "name": "Get Pending Returns",
      "type": "n8n-nodes-homebot.homebot",
      "parameters": {
        "resource": "returns",
        "operation": "getExpiring",
        "days": 3
      }
    },
    {
      "name": "Send Notification",
      "type": "n8n-nodes-base.pushover",
      "parameters": {
        "title": "Return Deadline Approaching"
      }
    }
  ]
}
```

### AI Inventory Assistant

```json
{
  "name": "Homebot AI Assistant",
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook"
    },
    {
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "parameters": {
        "agent": "toolsAgent",
        "systemMessage": "You are a helpful home inventory assistant."
      }
    },
    {
      "name": "Homebot Tool",
      "type": "n8n-nodes-homebot.homebotTool",
      "parameters": {
        "availableTools": [
          "lookupBarcode",
          "searchProducts",
          "getExpiringProducts",
          "getCookableRecipes"
        ]
      }
    }
  ]
}
```

## 91.13.7 Installation

```bash
# Install from npm
npm install n8n-nodes-homebot

# Or in n8n UI:
# Settings > Community Nodes > Install > n8n-nodes-homebot
```

## 91.13.8 Publishing

```bash
# Build and publish
npm run build
npm run lint
npm publish

# Submit to n8n Creator Portal
# https://creators.n8n.io
```

---

## Navigation

- **Previous:** [User Documentation](91.12-user-documentation.md)
- **Next:** [Decision Log](91.14-decision-log.md)
- **Back to:** [README](README.md)
