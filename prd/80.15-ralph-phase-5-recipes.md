# 80.15 Ralph Phase 5: Recipes & Lists

This is the Ralph Wiggum task document for Phase 5 - Recipes and shopping lists.

---

## Frontmatter

```yaml
phase: 5
name: Recipes & Lists
description: Recipe management, meal planning, shopping lists
test_command: pytest tests/phase5/ -v --tb=short
browser_validation: true
estimated_criteria: 11
```

---

## Overview

Phase 5 implements meal planning features:

- Recipe storage with ingredients
- Meal calendar
- "What can I make?" analysis
- Shopping list generation
- Shopping mode UI

---

## Acceptance Criteria

### Recipes

- [ ] **[1] [CRITICAL]** Recipes table with ingredients
  - Test: `\d recipes` shows name, servings, instructions
  - Test: `\d recipe_ingredients` links to products

- [ ] **[2] [CRITICAL]** Recipe CRUD endpoints
  - Test: `POST /api/v2/recipes` creates recipe with ingredients
  - Test: `GET /api/v2/recipes/{id}` returns full recipe

- [ ] **[3] [CORE]** Recipe scaling
  - Test: `GET /api/v2/recipes/{id}?servings=8` scales ingredients
  - BrowserMCP: Change servings, quantities update

### Meal Planning

- [ ] **[4] [CRITICAL]** Meal plans table
  - Test: `\d meal_plans` shows date, meal_type, recipe_id

- [ ] **[5] [CRITICAL]** Plan meal endpoint
  - Test: `POST /api/v2/meal-plans` adds meal to calendar
  - BrowserMCP: Click day, add meal dialog opens

- [ ] **[6] [CORE]** Week view calendar
  - BrowserMCP: View week, meals displayed by day/type
  - BrowserMCP: Navigate weeks with arrows

### Inventory Check

- [ ] **[7] [CORE]** "What can I make?" endpoint
  - Test: `GET /api/v2/recipes/cookable` returns sorted by availability
  - Test: Missing ingredients listed per recipe

- [ ] **[8] [FLEX]** Ingredient availability indicator on recipes
  - BrowserMCP: Recipe card shows green/yellow/red status

### Shopping Lists

- [ ] **[9] [CRITICAL]** Shopping lists with items
  - Test: `\d shopping_lists` and `shopping_list_items` exist
  - Test: `POST /api/v2/shopping-lists` creates list

- [ ] **[10] [CRITICAL]** Generate from meal plan
  - Test: `POST /api/v2/shopping-lists/generate` creates list from meals
  - Test: Existing inventory subtracted from needs

- [ ] **[11] [CORE]** Shopping mode UI
  - BrowserMCP: Start shopping, items grouped by category
  - BrowserMCP: Check item, strikes through

---

## Test Command

```bash
# Run all Phase 5 tests
pytest tests/phase5/ -v --tb=short

# Specific test files
pytest tests/phase5/test_recipes.py -v
pytest tests/phase5/test_meal_plans.py -v
pytest tests/phase5/test_shopping_lists.py -v
```

---

## Dependencies

- Phase 2 complete (products for ingredient linking)
- Phase 3 complete (UI framework)

---

## Files to Create/Modify

```
app/
├── models/
│   ├── recipe.py            # Recipe + ingredients
│   ├── meal_plan.py         # Meal plans
│   └── shopping_list.py     # Shopping lists
├── api/routes/
│   ├── recipes.py           # Recipe endpoints
│   ├── meal_plans.py        # Meal plan endpoints
│   └── shopping_lists.py    # Shopping list endpoints
├── services/
│   ├── recipe.py            # Recipe service
│   ├── meal_plan.py         # Meal planning
│   └── shopping_list.py     # List generation
└── schemas/
    ├── recipe.py
    ├── meal_plan.py
    └── shopping_list.py

frontend/src/
├── pages/
│   ├── RecipesPage.vue
│   ├── RecipeDetail.vue
│   ├── MealPlanPage.vue     # Week calendar
│   ├── ShoppingListsPage.vue
│   └── ShoppingMode.vue     # Checklist UI
└── components/
    ├── RecipeCard.vue
    ├── MealCalendar.vue
    ├── AddMealDialog.vue
    └── ShoppingItem.vue

migrations/versions/
├── 009_recipes.py
├── 010_meal_plans.py
└── 011_shopping_lists.py

tests/phase5/
├── test_recipes.py
├── test_meal_plans.py
├── test_shopping_lists.py
└── test_cookable.py
```

---

## BrowserMCP Validation Checklist

```markdown
1. [ ] Create recipe with 3+ ingredients
2. [ ] View recipe, ingredients linked to products
3. [ ] Scale recipe to 8 servings
4. [ ] Add meal to calendar
5. [ ] View week, meal appears
6. [ ] Check "What can I make?"
7. [ ] Generate shopping list from meal plan
8. [ ] Enter shopping mode, check items off
```

---

## Navigation

- **Previous:** [Phase 4: Labels & QR](80.14-ralph-phase-4-labels-qr.md)
- **Next:** [Phase 6: Intelligence](80.16-ralph-phase-6-intelligence.md)
- **Back to:** [README](README.md)
