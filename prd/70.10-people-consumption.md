# 70.10 People & Consumption

This document specifies the household member tracking and consumption logging system for Homebot.

---

## 70.10.1 Overview

Track household members and their consumption:

- **Household members** - Who lives in the household
- **Consumption logging** - Track who consumed what
- **Routines** - Morning vitamins, medication schedules
- **Preferences** - Dietary restrictions, favorites
- **Analytics** - Consumption patterns per person

---

## 70.10.2 Data Model

### People

```sql
CREATE TABLE people (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- Identity
    name VARCHAR(100) NOT NULL,
    nickname VARCHAR(50),
    avatar_url TEXT,
    color VARCHAR(7),  -- Hex color for UI
    
    -- Optional user link
    user_id UUID REFERENCES users(id),  -- NULL if not a system user
    
    -- Preferences
    dietary_restrictions TEXT[],  -- vegetarian, gluten-free, etc.
    allergies TEXT[],
    favorite_products UUID[],
    
    -- Status
    is_active BOOLEAN DEFAULT TRUE,
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS
ALTER TABLE people ENABLE ROW LEVEL SECURITY;
CREATE POLICY people_tenant_isolation ON people
    USING (tenant_id = current_setting('app.tenant_id')::uuid);
```

### Consumption Logs

```sql
CREATE TABLE consumption_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- What was consumed
    product_id UUID REFERENCES products(id),
    instance_id UUID REFERENCES product_instances(id),
    
    -- Who consumed it
    person_id UUID REFERENCES people(id),
    
    -- Details
    quantity INTEGER NOT NULL DEFAULT 1,
    quantity_unit VARCHAR(50),  -- pills, servings, etc.
    
    -- When
    consumed_at TIMESTAMPTZ DEFAULT NOW(),
    
    -- Context
    routine_id UUID REFERENCES routines(id),
    notes TEXT,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_consumption_person ON consumption_logs(person_id);
CREATE INDEX idx_consumption_product ON consumption_logs(product_id);
CREATE INDEX idx_consumption_date ON consumption_logs(consumed_at);

-- RLS
ALTER TABLE consumption_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY consumption_tenant_isolation ON consumption_logs
    USING (tenant_id = current_setting('app.tenant_id')::uuid);
```

### Routines

```sql
CREATE TABLE routines (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    name VARCHAR(100) NOT NULL,
    description TEXT,
    
    -- Who
    person_id UUID REFERENCES people(id),  -- NULL = all people
    
    -- Schedule
    schedule_type VARCHAR(20) NOT NULL,  -- daily, weekly, custom
    schedule_time TIME,
    schedule_days INTEGER[],  -- 0-6 for weekly (0=Sunday)
    
    -- Items
    items JSONB NOT NULL,  -- [{product_id, quantity, quantity_unit}]
    
    -- Status
    is_active BOOLEAN DEFAULT TRUE,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 70.10.3 Routine Types

| Type | Example | Schedule |
|------|---------|----------|
| **Daily** | Morning vitamins | Every day at 8:00 AM |
| **Weekly** | Meal prep supplements | Sundays at 6:00 PM |
| **Medication** | Prescription drugs | Multiple times daily |
| **As-needed** | Allergy medicine | No schedule, tracked when taken |

---

## 70.10.4 UI Design

### Household Members

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Household                                          [+ Add Person]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ğŸ‘¤     â”‚  â”‚  ğŸ‘¤     â”‚  â”‚  ğŸ‘¤     â”‚  â”‚  ğŸ‘¤     â”‚            â”‚
â”‚  â”‚  Alex   â”‚  â”‚  Jordan â”‚  â”‚  Sam    â”‚  â”‚  Riley  â”‚            â”‚
â”‚  â”‚ (Admin) â”‚  â”‚         â”‚  â”‚ (Child) â”‚  â”‚         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”‚  Quick Actions:                                                  â”‚
â”‚  [Log Consumption]  [View Routines]  [See Analytics]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Log Consumption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Log Consumption                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Who:  [Alex â–¼]                                                 â”‚
â”‚                                                                  â”‚
â”‚  What: [Search product...                                   ğŸ”] â”‚
â”‚        Selected: Advil 200mg                                    â”‚
â”‚                                                                  â”‚
â”‚  Quantity: [2] [pills â–¼]                                        â”‚
â”‚                                                                  â”‚
â”‚  When: [Just now â–¼]                                             â”‚
â”‚        â—‹ Just now                                               â”‚
â”‚        â—‹ This morning                                           â”‚
â”‚        â—‹ Custom time...                                         â”‚
â”‚                                                                  â”‚
â”‚  Routine: [Morning Vitamins â–¼] (optional)                       â”‚
â”‚                                                                  â”‚
â”‚                                              [Cancel] [Log]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Routine Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Routine: Morning Vitamins                        [Edit] [Delete]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  For: Alex                                                       â”‚
â”‚  Schedule: Daily at 8:00 AM                                     â”‚
â”‚                                                                  â”‚
â”‚  Items:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Vitamin D - 1 tablet                            [Edit] âœ“  â”‚  â”‚
â”‚  â”‚ Fish Oil - 2 capsules                           [Edit] âœ“  â”‚  â”‚
â”‚  â”‚ Multivitamin - 1 tablet                         [Edit] âœ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              [+ Add Item]       â”‚
â”‚                                                                  â”‚
â”‚  Today's Status: âœ… Completed at 8:15 AM                        â”‚
â”‚                                                                  â”‚
â”‚  Recent History:                                                 â”‚
â”‚  â€¢ Feb 3 - Completed âœ“                                          â”‚
â”‚  â€¢ Feb 2 - Completed âœ“                                          â”‚
â”‚  â€¢ Feb 1 - Missed âœ—                                             â”‚
â”‚  â€¢ Jan 31 - Completed âœ“                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.10.5 API Endpoints

### Create Person

```http
POST /api/v2/people
Content-Type: application/json

{
  "name": "Alex",
  "nickname": "Al",
  "color": "#3B82F6",
  "dietary_restrictions": ["vegetarian"],
  "allergies": ["peanuts"]
}
```

### Log Consumption

```http
POST /api/v2/consumption
Content-Type: application/json

{
  "person_id": "...",
  "product_id": "...",
  "instance_id": "...",
  "quantity": 2,
  "quantity_unit": "pills",
  "routine_id": "..."
}
```

### Create Routine

```http
POST /api/v2/routines
Content-Type: application/json

{
  "name": "Morning Vitamins",
  "person_id": "...",
  "schedule_type": "daily",
  "schedule_time": "08:00",
  "items": [
    { "product_id": "...", "quantity": 1, "quantity_unit": "tablet" },
    { "product_id": "...", "quantity": 2, "quantity_unit": "capsules" }
  ]
}
```

### Get Consumption History

```http
GET /api/v2/people/{id}/consumption?from=2026-01-01&to=2026-02-03

Response:
{
  "person": { "name": "Alex" },
  "consumption": [
    {
      "product": "Advil 200mg",
      "quantity": 2,
      "consumed_at": "2026-02-03T08:15:00Z",
      "routine": "Morning Vitamins"
    }
  ],
  "summary": {
    "total_items": 45,
    "routines_completed": 28,
    "routines_missed": 2
  }
}
```

---

## 70.10.6 Quick Consumption Actions

### From Scan

When scanning a product with consumption tracking enabled:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Advil 200mg                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Instance: K3D-7K3QF-X (93/100 pills remaining)                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Take 1        â”‚  â”‚   Take 2        â”‚  â”‚   [Custom]      â”‚  â”‚
â”‚  â”‚   for Alex      â”‚  â”‚   for Alex      â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Or log for someone else: [Jordan] [Sam] [Riley]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.10.7 Analytics

### Per-Person Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Alex's Consumption - February 2026                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Routine Compliance: 93%                                        â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘                   â”‚
â”‚                                                                  â”‚
â”‚  Most Consumed:                                                  â”‚
â”‚  1. Vitamin D (28 tablets)                                      â”‚
â”‚  2. Fish Oil (56 capsules)                                      â”‚
â”‚  3. Advil (12 pills)                                            â”‚
â”‚                                                                  â”‚
â”‚  Missed Routines:                                                â”‚
â”‚  â€¢ Feb 1 - Morning Vitamins                                     â”‚
â”‚  â€¢ Feb 15 - Evening Supplements                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.10.8 User Stories

| ID | Story | Priority |
|----|-------|----------|
| US-PPL-01 | As a user, I want to add household members to track consumption | [CRITICAL] |
| US-PPL-02 | As a user, I want to log what I consumed and when | [CRITICAL] |
| US-PPL-03 | As a user, I want to create daily vitamin routines | [CORE] |
| US-PPL-04 | As a user, I want to see if someone completed their routine | [CORE] |
| US-PPL-05 | As a user, I want consumption analytics per person | [FLEX] |
| US-PPL-06 | As a user, I want to track dietary restrictions for meal planning | [FLEX] |

---

## Navigation

- **Previous:** [Multi-Tenant](60.11-multi-tenant.md)
- **Next:** [Recipes & Meal Planning](70.11-recipes-meal-planning.md)
- **Back to:** [README](README.md)
