# 20.11 Functional Requirements

This document captures all functional requirements for Homebot.

---

## 20.11.1 Barcode Scanning

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-001 | Camera scanning | Use html5-qrcode library for device camera | [CRITICAL] |
| FR-002 | USB/Bluetooth scanner | Capture keyboard wedge input in scan mode | [CRITICAL] |
| FR-003 | Barcode validation | Validate UPC-A, UPC-E, EAN-13, EAN-8, Code128 | [CRITICAL] |
| FR-004 | QR code scanning | Support scanning Homebot QR codes | [CRITICAL] |
| FR-005 | Scan feedback | Audio beep + visual confirmation | [CORE] |

## 20.11.2 Product Lookup

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-010 | Multi-provider lookup | OpenFoodFacts, UPC Database, Brave Search | [CRITICAL] |
| FR-011 | Sequential fallback | Try providers in priority order | [CRITICAL] |
| FR-012 | Provider priority config | Configurable provider order | [CORE] |
| FR-013 | API key management | Secure storage for provider API keys | [CORE] |
| FR-014 | Image retrieval | Fetch and store product images | [CORE] |
| FR-015 | Result caching | Redis cache with configurable TTL | [CRITICAL] |

## 20.11.3 LLM Optimization

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-020 | Name cleaning | Transform messy names to proper format | [CORE] |
| FR-021 | Category inference | Assign category from name/description | [CORE] |
| FR-022 | Unit standardization | Normalize units (oz, g, ml, L) | [CORE] |
| FR-023 | Async processing | LLM calls are non-blocking | [CRITICAL] |
| FR-024 | Provider presets | OpenAI, Anthropic, Ollama support | [CORE] |

## 20.11.4 Inventory Management

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-030 | Product CRUD | Create, read, update, delete products | [CRITICAL] |
| FR-031 | Stock tracking | Track quantity by product and location | [CRITICAL] |
| FR-032 | Add stock | Increase quantity at location | [CRITICAL] |
| FR-033 | Consume stock | Decrease quantity with FIFO selection | [CRITICAL] |
| FR-034 | Transfer stock | Move between locations | [CORE] |
| FR-035 | Expiration tracking | Track best_before per stock entry | [CRITICAL] |
| FR-036 | Low stock alerts | Alert when below min_stock_quantity | [CORE] |

## 20.11.5 Location Hierarchy

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-040 | Location CRUD | Create, read, update, delete locations | [CRITICAL] |
| FR-041 | Hierarchical nesting | 5-7 levels deep (property → room → area → shelf) | [CRITICAL] |
| FR-042 | Closure table | Efficient ancestor/descendant queries | [CRITICAL] |
| FR-043 | Location types | Property, building, room, area, shelf, drawer | [CORE] |
| FR-044 | Sort order | Sibling ordering within parent | [CRITICAL] |

## 20.11.6 Container Management

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-050 | Container CRUD | Create, read, update, delete containers | [CORE] |
| FR-051 | Container nesting | 2-3 levels (bin → box → item) | [CORE] |
| FR-052 | Location inheritance | Container inherits location from parent | [CORE] |
| FR-053 | Container types | Bin, box, bag, basket, tote | [CORE] |
| FR-054 | Move container | Relocate with all contents | [CORE] |

## 20.11.7 QR Token System

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-060 | Token generation | Crockford Base32, NS-CODE-CHECK format | [CRITICAL] |
| FR-061 | Namespace support | 3-char tenant namespace prefix | [CRITICAL] |
| FR-062 | Checksum validation | Luhn mod 32 checksum | [CORE] |
| FR-063 | Token states | unassigned, assigned, revoked | [CORE] |
| FR-064 | QR routing | /q/{token} redirects to appropriate page | [CRITICAL] |
| FR-065 | Token assignment | Bind to product, location, or instance | [CRITICAL] |

## 20.11.8 Label Printing

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-070 | Brother QL support | Print via brother_ql library | [CORE] |
| FR-071 | Label templates | JSON template definitions | [CORE] |
| FR-072 | Template variables | product.name, qr_url, expiration, etc. | [CORE] |
| FR-073 | Label preview | PNG preview before printing | [CORE] |
| FR-074 | Multiple sizes | 62mm, 29mm label support | [CORE] |

## 20.11.9 LPN Instance Tracking

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-080 | Instance creation | Create tracked instances per product | [CORE] |
| FR-081 | Remaining quantity | Track consumption (100 pills → 93 left) | [CORE] |
| FR-082 | QR binding | Assign QR token to instance | [CORE] |
| FR-083 | FIFO enforcement | Consume oldest/soonest-expiring first | [CORE] |
| FR-084 | Instance states | created, sealed, opened, consumed | [CORE] |

## 20.11.10 Device Preferences

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-090 | Device registration | Browser fingerprint + UUID | [CRITICAL] |
| FR-091 | Device naming | User-assigned device names | [CRITICAL] |
| FR-092 | Default action mode | Add, consume, transfer, lookup | [CRITICAL] |
| FR-093 | Default location | Pre-set location per device | [CORE] |
| FR-094 | Scanner mode | Camera, keyboard wedge, hybrid | [CORE] |

## 20.11.11 People & Consumption

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-100 | Person CRUD | Create, read, update, deactivate people; optional link to user accounts | [CORE] |
| FR-101 | Consumption logging | Record who consumed what | [CORE] |
| FR-102 | Routines | Daily/weekly scheduled consumption | [CORE] |
| FR-103 | Dietary restrictions | Store per-person restrictions | [CORE] |
| FR-104 | Allergen tracking | Store per-person allergies | [CORE] |

## 20.11.12 Recipes & Meal Planning

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-110 | Recipe CRUD | Create, read, update, delete recipes | [CORE] |
| FR-111 | Ingredient linking | Link to products | [CORE] |
| FR-112 | Recipe scaling | Adjust servings dynamically | [CORE] |
| FR-113 | Meal planning | Calendar with meal slots | [CORE] |
| FR-114 | Cookability check | Check inventory for ingredients | [CORE] |

## 20.11.13 Shopping Lists

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-120 | List CRUD | Create, read, update, delete lists | [CRITICAL] |
| FR-121 | Item management | Add, remove, check items | [CRITICAL] |
| FR-122 | Category organization | Group by produce, dairy, etc. | [CORE] |
| FR-123 | Generate from meal plan | Auto-create from planned meals | [CORE] |
| FR-124 | Shopping mode | Optimized checklist UI | [CORE] |

## 20.11.14 Cost Tracking

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-130 | Store management | Store CRUD | [CORE] |
| FR-131 | Purchase recording | Record purchases with items | [CORE] |
| FR-132 | DCA calculation | Dollar cost averaging per product | [CORE] |
| FR-133 | Cost summary | Materialized view for performance | [CORE] |

## 20.11.15 Food Intelligence

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-140 | Ingredient parsing | Extract from product data | [CORE] |
| FR-141 | Allergen detection | Flag FDA Top 9 allergens | [CORE] |
| FR-142 | Concern detection | Seed oils, artificial colors, etc. | [CORE] |
| FR-143 | Household alerts | Warn based on member allergies | [CORE] |
| FR-144 | Custom attributes | JSONB with dot-path operations | [CORE] |

## 20.11.16 Return Tracking

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-150 | Return policies | Store-specific return rules | [CORE] |
| FR-151 | Returnable items | Track items with deadlines | [CORE] |
| FR-152 | State machine | Ordered → Received → ... → Returned | [CORE] |
| FR-153 | Deadline notifications | Alert before deadline | [CORE] |

## 20.11.17 Multi-Tenant

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-160 | Tenant creation | Create household/organization | [CRITICAL] |
| FR-161 | Tenant membership | Users can belong to tenants | [CRITICAL] |
| FR-162 | PostgreSQL RLS | Row-level security on all tables | [CRITICAL] |
| FR-163 | Session tenant | app.tenant_id session variable | [CRITICAL] |
| FR-164 | QR namespaces | Tenant-scoped token namespaces | [CRITICAL] |

## 20.11.18 Authentication

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-170 | User registration | Email/password signup | [CRITICAL] |
| FR-171 | JWT authentication | Access tokens for v2 API | [CRITICAL] |
| FR-172 | API key auth | Service tokens for automation | [CRITICAL] |
| FR-173 | Grocy API key | GROCY-API-KEY header support | [CORE] |
| FR-174 | Session management | Cookie-based browser sessions | [CRITICAL] |
| FR-175 | Password change | Allow authenticated users to change password (verify current password) | [CORE] |

## 20.11.19 Grocy Compatibility

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-180 | Stock endpoints | /api/stock, /api/stock/products/{id}/add | [CORE] |
| FR-181 | Product endpoints | /api/objects/products | [CORE] |
| FR-182 | Location endpoints | /api/objects/locations | [CORE] |
| FR-183 | API translation | Map Grocy models to Homebot models | [CORE] |

## 20.11.20 Integrations

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-190 | Paperless client | Upload and link documents | [FLEX] |
| FR-191 | Integration settings | UI for configuration | [CORE] |
| FR-192 | Health checks | Service status endpoints | [CORE] |
| FR-193 | CORS configuration | Configurable allowed origins | [CORE] |

## 20.11.21 UI / PWA

| ID | Requirement | Details | Priority |
|----|-------------|---------|----------|
| FR-200 | Responsive layout | Tablet-first (768–1024px), mobile (320px min), desktop (1025px+) | [CRITICAL] |
| FR-201 | Installable PWA | Web app manifest, service worker, HTTPS in production | [CORE] |
| FR-202 | Offline support | Shell loads from cache; core read flows work offline; mutations queue and sync when online | [CORE] |
| FR-203 | Safe areas | All chrome (nav, dialogs) respects `env(safe-area-inset-*)` for notch/home indicator | [CORE] |
| FR-204 | Touch targets | Minimum 44×44pt tap targets; no hover-only primary actions | [CRITICAL] |
| FR-205 | Core Web Vitals | LCP ≤2.5s, INP ≤200ms, CLS ≤0.1 (Lighthouse "Good" range) | [CORE] |
| FR-206 | Input methods | Support keyboard, mouse, touch, and stylus; no touch-only critical paths | [CORE] |

See [30.13 UI Specification](30.13-ui-specification.md) for full design details.

---

## Navigation

- **Previous:** [User Stories](20.10-user-stories.md)
- **Next:** [Technical Architecture](30.10-technical-architecture.md)
- **Back to:** [README](README.md)
