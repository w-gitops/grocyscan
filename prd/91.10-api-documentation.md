# 91.10 API Documentation & External Access

## 91.10.1 Interactive API Documentation

FastAPI automatically generates interactive documentation based on the OpenAPI standard.

### Documentation Endpoints

| Endpoint | UI | Description |
|----------|-----|-------------|
| `/docs` | Swagger UI | Interactive exploration and testing |
| `/redoc` | ReDoc | Alternative API documentation |
| `/api/v2/openapi.json` | JSON Schema | Raw OpenAPI specification |

## 91.10.2 FastAPI Configuration

```python
# app/main.py
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi

app = FastAPI(
    title="Homebot API",
    description="""
    Homebot - Home Inventory Management System
    
    ## Features
    * Barcode scanning and lookup
    * Multi-tenant inventory management
    * QR code routing and label printing
    * Recipe and meal planning
    * Grocy API compatibility
    """,
    version="2.0.0",
    openapi_url="/api/v2/openapi.json",
    docs_url="/docs",
    redoc_url="/redoc",
)


def custom_openapi():
    if app.openapi_schema:
        return app.openapi_schema
    
    openapi_schema = get_openapi(
        title="Homebot API",
        version="2.0.0",
        routes=app.routes,
    )
    
    # Add security schemes
    openapi_schema["components"]["securitySchemes"] = {
        "BearerAuth": {
            "type": "http",
            "scheme": "bearer"
        },
        "ApiKeyAuth": {
            "type": "apiKey",
            "in": "header",
            "name": "HOMEBOT-API-KEY"
        },
        "GrocyApiKey": {
            "type": "apiKey",
            "in": "header",
            "name": "GROCY-API-KEY"
        }
    }
    
    app.openapi_schema = openapi_schema
    return app.openapi_schema

app.openapi = custom_openapi
```

## 91.10.3 External Application Access

External programs can call Homebot for lookups via the external API.

### External API Endpoints

```python
# app/api/routes/external.py
from fastapi import APIRouter, Depends, Query
from app.api.deps import verify_api_key

router = APIRouter(prefix="/api/v2/external", tags=["external"])


@router.get("/lookup/{barcode}")
async def external_barcode_lookup(
    barcode: str,
    include_image: bool = Query(True),
    api_key: str = Depends(verify_api_key)
):
    """
    Look up product information by barcode.
    
    **Rate Limit:** 100 requests/minute per API key
    """
    pass


@router.post("/lookup/batch")
async def external_batch_lookup(
    barcodes: list[str],
    api_key: str = Depends(verify_api_key)
):
    """Look up multiple barcodes (max 50 per request)."""
    pass
```

## 91.10.4 Usage Examples

### cURL

```bash
# Lookup a barcode (v2 API)
curl -X GET "http://localhost:3334/api/v2/external/lookup/012345678901" \
  -H "Authorization: Bearer your-token-here"

# Batch lookup
curl -X POST "http://localhost:3334/api/v2/external/lookup/batch" \
  -H "Authorization: Bearer your-token-here" \
  -H "Content-Type: application/json" \
  -d '{"barcodes": ["012345678901", "987654321098"]}'

# Grocy-compatible API
curl -X GET "http://localhost:3334/api/stock" \
  -H "GROCY-API-KEY: your-grocy-api-key"
```

### Python

```python
import httpx

# Using Bearer token (v2 API)
client = httpx.Client(
    base_url="http://localhost:3334",
    headers={"Authorization": "Bearer your-token-here"}
)

response = client.get("/api/v2/external/lookup/012345678901")
product = response.json()
print(f"Product: {product['name']}")

# Using Grocy-compatible API
grocy_client = httpx.Client(
    base_url="http://localhost:3334",
    headers={"GROCY-API-KEY": "your-grocy-key"}
)

stock = grocy_client.get("/api/stock").json()
```

---

## Navigation

- **Previous:** [Ralph Phase 7](80.17-ralph-phase-7-documents.md)
- **Next:** [MCP Server](91.11-mcp-server.md)
- **Back to:** [README](README.md)
