# 80.10 Ralph Phases Overview

This document provides an overview of the 7-phase Ralph Wiggum execution plan for building Homebot.

---

## 80.10.1 Phase Summary

| Phase | Focus | Key Deliverable | Est. Criteria |
|-------|-------|-----------------|---------------|
| 1 | Foundation | Running skeleton with auth | ~10 |
| 2 | Inventory | Basic scan-to-add workflow | ~12 |
| 3 | Device & UI | Vue/Quasar tablet interface | ~12 |
| 3.5 | Inventory Parity | Full Grocy parity, advanced stock ops | ~17 |
| 4 | Labels & QR | QR routing, label printing | ~11 |
| 5 | Recipes | Meal planning, shopping | ~11 |
| 6 | Intelligence | Food analysis, cost tracking | ~11 |
| 7 | Documents | Paperless, returns | ~10 |
| **Total** | | | **~94** |

---

## 80.10.2 Phase Dependencies

```
┌─────────────────┐
│  Phase 1        │  Foundation
│  Foundation     │  - PostgreSQL + RLS
└────────┬────────┘  - FastAPI + Auth
         │           - Multi-tenant
         ▼
┌─────────────────┐
│  Phase 2        │  Inventory Core
│  Inventory      │  - Products, Locations
└────────┬────────┘  - Barcode Lookup
         │           - Stock Management
         ▼
┌─────────────────┐
│  Phase 3        │  Device & UI
│  Device UI      │  - Vue/Quasar
└────────┬────────┘  - Scanner Interface
         │           - Device Preferences
         ▼
┌─────────────────┐
│  Phase 3.5      │  Inventory Parity
│  Inv. Parity    │  - Quantity Units
└────────┬────────┘  - Advanced Stock Ops
         │           - Location UI
         │
    ┌────┴────┐
    ▼         ▼
┌────────┐ ┌────────┐
│Phase 4 │ │Phase 5 │  Can run in parallel
│Labels  │ │Recipes │  after Phase 3.5
└────┬───┘ └────┬───┘
     │         │
     └────┬────┘
          ▼
┌─────────────────┐
│  Phase 6        │  Intelligence
│  Intelligence   │  - Custom Attributes
└────────┬────────┘  - Cost Tracking
         │           - Food Analysis
         ▼
┌─────────────────┐
│  Phase 7        │  Documents
│  Documents      │  - Paperless-ngx
└─────────────────┘  - Returns
```

---

## 80.10.3 Criticality Tags

Each criterion is tagged with its priority:

| Tag | Meaning | Gate Behavior |
|-----|---------|---------------|
| `[CRITICAL]` | Must work for phase to complete | Blocks phase completion |
| `[CORE]` | Expected functionality | Should complete, can defer |
| `[FLEX]` | Nice to have | Can skip if time constrained |
| `[FUTURE]` | Planned for later | Skip entirely in phase |

### Completion Rules

- **Phase Complete**: All `[CRITICAL]` criteria pass
- **Phase Excellent**: All `[CRITICAL]` + `[CORE]` pass
- **Phase Perfect**: All except `[FUTURE]` pass

---

## 80.10.4 Test Commands

Each phase has a standard test command:

```yaml
# Phase 1
test_command: "pytest tests/unit/test_auth.py tests/unit/test_tenant.py -v"

# Phase 2
test_command: "pytest tests/unit/test_products.py tests/unit/test_stock.py tests/integration/test_lookup.py -v"

# Phase 3
test_command: "npm run test:unit && pytest tests/e2e/test_scan_flow.py -v"

# Phase 3.5
test_command: "pytest tests/phase3_5/ tests/phase3/ tests/phase2/ -v --tb=short"

# Phase 4
test_command: "pytest tests/unit/test_qr.py tests/unit/test_labels.py -v"

# Phase 5
test_command: "pytest tests/unit/test_recipes.py tests/unit/test_shopping.py -v"

# Phase 6
test_command: "pytest tests/unit/test_attributes.py tests/unit/test_cost.py -v"

# Phase 7
test_command: "pytest tests/integration/test_paperless.py tests/unit/test_returns.py -v"
```

---

## 80.10.5 Phase Documents

Each phase has a detailed task document:

| Document | Phase | Description |
|----------|-------|-------------|
| [80.11](80.11-ralph-phase-1-foundation.md) | Foundation | PostgreSQL, FastAPI, Auth |
| [80.12](80.12-ralph-phase-2-inventory.md) | Inventory | Products, Lookup, Stock |
| [80.13](80.13-ralph-phase-3-device-ui.md) | Device UI | Vue/Quasar, Scanner |
| [80.135](80.135-ralph-phase-3.5-inventory-parity.md) | Inventory Parity | Grocy Parity, Stock Ops, Location UI |
| [80.14](80.14-ralph-phase-4-labels-qr.md) | Labels & QR | QR System, Printing |
| [80.15](80.15-ralph-phase-5-recipes.md) | Recipes | Meal Plans, Shopping |
| [80.16](80.16-ralph-phase-6-intelligence.md) | Intelligence | Attributes, Costs |
| [80.17](80.17-ralph-phase-7-documents.md) | Documents | Paperless, Returns |

---

## 80.10.6 Ralph Task Format

Each phase document uses this format:

```yaml
---
task: Phase N - [Phase Name]
test_command: "pytest tests/... -v"
browser_validation: true|false
base_url: "http://localhost:3334"
---

## Success Criteria

1. [ ] [CRITICAL] First criterion description
2. [ ] [CRITICAL] Second criterion description
3. [ ] [CORE] Third criterion description
4. [ ] [FLEX] Fourth criterion description
5. [ ] [FUTURE] Fifth criterion (skip this phase)

## Technical Notes

[Implementation guidance, dependencies, etc.]
```

---

## 80.10.7 BrowserMCP Validation

Phases with UI components require browser validation:

| Phase | Browser Validation | Key Flows |
|-------|-------------------|-----------|
| 1 | Yes | Login, tenant selection |
| 2 | No | API-only |
| 3 | **Yes** | Scan page, location browser |
| 3.5 | **Yes** | Location CRUD, stock entry edit, move, inventory |
| 4 | Yes | Label designer, print preview |
| 5 | Yes | Recipe editor, meal calendar |
| 6 | No | API-focused |
| 7 | Yes | Return tracker UI |

### Browser Test Pattern

```python
# tests/e2e/test_scan_flow.py
def test_scan_and_add_product(browser):
    """E2E test for scanning a barcode and adding to inventory."""
    # Navigate to scan page
    browser.navigate("http://localhost:3335/scan")
    
    # Enter barcode
    browser.fill("#barcode-input", "012345678901")
    browser.click("#scan-button")
    
    # Wait for lookup
    browser.wait_for_element("#product-review-dialog")
    
    # Verify product found
    assert browser.text("#product-name") == "Expected Product"
    
    # Add to inventory
    browser.click("#add-to-inventory")
    
    # Verify success
    browser.wait_for_toast("Product added successfully")
```

---

## 80.10.8 Deployment Target

All phases deploy to the same server:

| Property | Value |
|----------|-------|
| Host | `192.168.200.37` |
| SSH | `root@192.168.200.37` |
| Install Path | `/opt/homebot/` |
| Service | `homebot` (systemd) |
| API Port | 3334 |
| Frontend Port | 3335 |

### Deploy Between Phases

```bash
# After completing a phase
git push origin dev

# Deploy to server
./scripts/deploy.ps1 -Target all

# Verify
ssh root@192.168.200.37 "systemctl status homebot"
```

---

## 80.10.9 Progress Tracking

Progress is tracked in `.ralph/` directory:

```
.ralph/
├── progress.md          # Session history
├── guardrails.md        # Lessons learned
├── screenshots/         # Browser evidence
│   ├── phase-1-login.png
│   ├── phase-3-scan.png
│   └── ...
└── failures.md          # Failed attempts (auto-generated)
```

### Progress Entry Format

```markdown
## Session 2026-02-03 14:30

### Phase 1 Progress
- [x] 1.1 PostgreSQL schema - Completed, RLS policies working
- [x] 1.2 FastAPI scaffold - API responding on :3334
- [ ] 1.3 Authentication - In progress, JWT tokens working

### Notes
- Used `asyncpg` for better performance
- Added guardrail: Always set `app.tenant_id` before queries

### Commits
- `ralph: [1.1] PostgreSQL schema with tenant RLS`
- `ralph: [1.2] FastAPI project structure`
```

---

## 80.10.10 Guardrail Examples

Common guardrails that apply across phases:

```markdown
### Sign: Always Set Tenant Context
- **Trigger**: Any database query
- **Instruction**: Set `app.tenant_id` in session before queries
- **Added after**: Phase 1 - RLS returned empty results

### Sign: Test RLS with Multiple Tenants
- **Trigger**: Writing tests for tenant-isolated data
- **Instruction**: Create fixtures with 2+ tenants, verify isolation
- **Added after**: Phase 1 - Cross-tenant data leak in tests

### Sign: Check Browser Element Exists
- **Trigger**: BrowserMCP interactions
- **Instruction**: Always call browser_snapshot before click/type
- **Added after**: Phase 3 - Clicked non-existent element
```

---

## 80.10.11 Milestone Checkpoints

### Phase 1 Complete

- [ ] Can register and login
- [ ] Can create tenant
- [ ] RLS isolates data

### Phase 2 Complete

- [ ] Can scan barcode
- [ ] Can add product to inventory
- [ ] Stock shows in location

### Phase 3 Complete

- [ ] Tablet UI renders
- [ ] Camera scanner works
- [ ] Device preferences persist

### Phase 3.5 Complete

- [ ] Quantity units and conversions work
- [ ] Stock entries have price, open status, notes
- [ ] Inventory/Open/Edit/Undo operations work
- [ ] Location CRUD in UI
- [ ] Stock entry editing in UI

### Phase 4 Complete

- [ ] QR codes route correctly
- [ ] Labels print to Brother QL
- [ ] Can design custom labels

### Phase 5 Complete

- [ ] Can create recipe
- [ ] Can plan meals
- [ ] Shopping list generates

### Phase 6 Complete

- [ ] Custom attributes work
- [ ] Costs track per product
- [ ] Instances track remaining

### Phase 7 Complete

- [ ] Paperless connected
- [ ] Returns track with deadlines
- [ ] Notifications work

---

## Navigation

- **Previous:** [Integrations Settings](70.17-integrations-settings.md)
- **Next:** [Phase 1 - Foundation](80.11-phase-1-foundation.md)
- **Back to:** [README](README.md)
