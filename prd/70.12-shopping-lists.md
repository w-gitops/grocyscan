# 70.12 Shopping Lists

This document specifies the shopping list management system for Homebot.

---

## 70.12.1 Overview

Manage shopping lists efficiently:

- **Multiple lists** - Weekly groceries, Costco run, party supplies
- **Auto-generation** - From meal plans, low stock alerts
- **Store organization** - Group by store or aisle
- **Check-off** - Mark items while shopping
- **Sharing** - Share lists with household members

---

## 70.12.2 Data Model

### Shopping Lists

```sql
CREATE TABLE shopping_lists (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    name VARCHAR(100) NOT NULL,
    description TEXT,
    
    -- Target store (optional)
    store_id UUID REFERENCES stores(id),
    
    -- Status
    status VARCHAR(20) DEFAULT 'active',  -- active, shopping, completed, archived
    
    -- Dates
    due_date DATE,
    completed_at TIMESTAMPTZ,
    
    -- Source
    source_type VARCHAR(20),  -- manual, meal_plan, low_stock
    source_id UUID,  -- meal_plan_id, etc.
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS
ALTER TABLE shopping_lists ENABLE ROW LEVEL SECURITY;
CREATE POLICY shopping_lists_tenant_isolation ON shopping_lists
    USING (tenant_id = current_setting('app.tenant_id')::uuid);
```

### Shopping List Items

```sql
CREATE TABLE shopping_list_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    list_id UUID NOT NULL REFERENCES shopping_lists(id) ON DELETE CASCADE,
    
    -- Product link (optional)
    product_id UUID REFERENCES products(id),
    
    -- Item details
    name VARCHAR(255) NOT NULL,
    quantity DECIMAL(10, 3) NOT NULL DEFAULT 1,
    quantity_unit VARCHAR(50),
    
    -- Organization
    category VARCHAR(50),  -- produce, dairy, frozen, etc.
    aisle VARCHAR(50),
    
    -- Status
    is_checked BOOLEAN DEFAULT FALSE,
    checked_at TIMESTAMPTZ,
    checked_by UUID REFERENCES users(id),
    
    -- Price (optional)
    estimated_price DECIMAL(10, 2),
    actual_price DECIMAL(10, 2),
    
    -- Notes
    notes TEXT,
    
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_shopping_items_list ON shopping_list_items(list_id);
CREATE INDEX idx_shopping_items_checked ON shopping_list_items(is_checked);
```

---

## 70.12.3 Category Organization

### Default Categories (Grocery Store Layout)

| Category | Icon | Typical Aisle |
|----------|------|---------------|
| `produce` | ðŸ¥¬ | Entrance |
| `bakery` | ðŸž | Perimeter |
| `dairy` | ðŸ¥› | Back wall |
| `meat` | ðŸ¥© | Back wall |
| `frozen` | ðŸ§Š | Inner aisles |
| `canned` | ðŸ¥« | Center aisles |
| `dry_goods` | ðŸ | Center aisles |
| `snacks` | ðŸ¿ | Center aisles |
| `beverages` | ðŸ¥¤ | Center aisles |
| `household` | ðŸ§¹ | Last aisles |
| `personal_care` | ðŸ§´ | Last aisles |
| `other` | ðŸ“¦ | Varies |

---

## 70.12.4 UI Design

### Shopping Lists View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shopping Lists                                    [+ New List]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Active Lists                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ðŸ›’ Weekly Groceries                           12 items    â”‚  â”‚
â”‚  â”‚    Due: Saturday â€¢ Target                     [Start] â–¶   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ðŸ›’ Costco Run                                 8 items     â”‚  â”‚
â”‚  â”‚    Due: Sunday â€¢ Costco                       [Start] â–¶   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Recently Completed                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ“ Last Week's Groceries            Completed Feb 1       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Shopping Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Weekly Groceries - Shopping Mode                    [Done] âœ“   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Target â€¢ 8/12 items checked                                    â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  67%          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ðŸ¥¬ Produce (2 items)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [âœ“] Bananas - 1 bunch                                     â”‚  â”‚
â”‚  â”‚ [ ] Spinach - 1 bag                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  ðŸ¥› Dairy (2 items)                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [âœ“] Milk - 1 gallon                                       â”‚  â”‚
â”‚  â”‚ [âœ“] Eggs - 1 dozen                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  ðŸ¥© Meat (1 item)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [ ] Chicken breast - 2 lbs                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  [+ Add Item]  [Scan Barcode ðŸ“·]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.12.5 List Generation

### From Meal Plan

```python
async def generate_shopping_list_from_meal_plan(
    tenant_id: UUID,
    start_date: date,
    end_date: date,
    db: Session
) -> ShoppingList:
    """Generate shopping list from meal plan."""
    
    # Get planned meals
    meals = db.query(MealPlan).filter(
        MealPlan.tenant_id == tenant_id,
        MealPlan.plan_date >= start_date,
        MealPlan.plan_date <= end_date
    ).all()
    
    # Aggregate ingredients
    needed = {}  # product_id -> quantity
    
    for meal in meals:
        if meal.recipe_id:
            recipe = db.query(Recipe).get(meal.recipe_id)
            scale = meal.servings / recipe.servings
            
            for ing in recipe.ingredients:
                key = ing.product_id or ing.name
                if key not in needed:
                    needed[key] = {
                        "name": ing.name,
                        "product_id": ing.product_id,
                        "quantity": 0,
                        "unit": ing.quantity_unit
                    }
                needed[key]["quantity"] += ing.quantity * scale
    
    # Subtract current inventory
    items = []
    for key, item in needed.items():
        if item["product_id"]:
            stock = get_product_stock(item["product_id"], tenant_id)
            item["quantity"] -= stock
        
        if item["quantity"] > 0:
            items.append(ShoppingListItem(
                name=item["name"],
                product_id=item["product_id"],
                quantity=item["quantity"],
                quantity_unit=item["unit"]
            ))
    
    # Create list
    return ShoppingList(
        tenant_id=tenant_id,
        name=f"Meal Plan {start_date} - {end_date}",
        source_type="meal_plan",
        items=items
    )
```

### From Low Stock

```python
async def generate_low_stock_list(tenant_id: UUID, db: Session) -> ShoppingList:
    """Generate list from products below minimum stock."""
    
    low_stock = db.query(Product).filter(
        Product.tenant_id == tenant_id,
        Product.min_stock_quantity > 0,
        Product.current_stock < Product.min_stock_quantity
    ).all()
    
    items = []
    for product in low_stock:
        needed = product.min_stock_quantity - product.current_stock
        items.append(ShoppingListItem(
            name=product.name,
            product_id=product.id,
            quantity=needed,
            quantity_unit=product.quantity_unit
        ))
    
    return ShoppingList(
        tenant_id=tenant_id,
        name="Restock List",
        source_type="low_stock",
        items=items
    )
```

---

## 70.12.6 API Endpoints

### Create Shopping List

```http
POST /api/v2/shopping-lists
Content-Type: application/json

{
  "name": "Weekly Groceries",
  "store_id": "...",
  "due_date": "2026-02-08",
  "items": [
    {
      "name": "Milk",
      "product_id": "...",
      "quantity": 1,
      "quantity_unit": "gallon",
      "category": "dairy"
    }
  ]
}
```

### Generate from Meal Plan

```http
POST /api/v2/shopping-lists/generate
Content-Type: application/json

{
  "source": "meal_plan",
  "start_date": "2026-02-03",
  "end_date": "2026-02-09",
  "name": "This Week's Groceries"
}
```

### Check/Uncheck Item

```http
PATCH /api/v2/shopping-lists/{list_id}/items/{item_id}
Content-Type: application/json

{
  "is_checked": true,
  "actual_price": 4.99
}
```

### Start Shopping Mode

```http
POST /api/v2/shopping-lists/{id}/start

Response:
{
  "id": "...",
  "status": "shopping",
  "items_by_category": {
    "produce": [...],
    "dairy": [...],
    "meat": [...]
  }
}
```

---

## 70.12.7 Sharing

### Share with Household

```sql
-- Lists are automatically visible to all tenant members
-- Can optionally assign a list to specific people

ALTER TABLE shopping_lists ADD COLUMN assigned_to UUID[];
```

### Real-time Sync

When one person checks an item, others see it immediately:

```typescript
// WebSocket message
{
  "type": "shopping_list.item_checked",
  "list_id": "...",
  "item_id": "...",
  "is_checked": true,
  "checked_by": "Alex"
}
```

---

## 70.12.8 User Stories

| ID | Story | Priority |
|----|-------|----------|
| US-SHP-01 | As a user, I want to create shopping lists | [CRITICAL] |
| US-SHP-02 | As a user, I want to check off items while shopping | [CRITICAL] |
| US-SHP-03 | As a user, I want items organized by category/aisle | [CORE] |
| US-SHP-04 | As a user, I want to generate a list from my meal plan | [CORE] |
| US-SHP-05 | As a user, I want to see lists shared with my household | [CORE] |
| US-SHP-06 | As a user, I want real-time sync when others check items | [FLEX] |

---

## Navigation

- **Previous:** [Recipes & Meal Planning](70.11-recipes-meal-planning.md)
- **Next:** [Food Intelligence](70.13-food-intelligence.md)
- **Back to:** [README](README.md)
