# 70.11 Recipes & Meal Planning

This document specifies the recipe management and meal planning system for Homebot.

---

## 70.11.1 Overview

Plan meals and manage recipes:

- **Recipe storage** - Ingredients, instructions, photos
- **Meal calendar** - Plan meals for days/weeks
- **Inventory check** - "What can I make?"
- **Scaling** - Adjust servings
- **Shopping integration** - Generate lists from meal plans

---

## 70.11.2 Data Model

### Recipes

```sql
CREATE TABLE recipes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- Basic info
    name VARCHAR(255) NOT NULL,
    description TEXT,
    
    -- Categorization
    category VARCHAR(50),  -- breakfast, lunch, dinner, snack, dessert
    cuisine VARCHAR(50),   -- italian, mexican, asian, etc.
    tags TEXT[],
    
    -- Timing
    prep_time_minutes INTEGER,
    cook_time_minutes INTEGER,
    total_time_minutes INTEGER GENERATED ALWAYS AS 
        (COALESCE(prep_time_minutes, 0) + COALESCE(cook_time_minutes, 0)) STORED,
    
    -- Servings
    servings INTEGER NOT NULL DEFAULT 4,
    servings_unit VARCHAR(50) DEFAULT 'servings',
    
    -- Instructions
    instructions JSONB,  -- [{step: 1, text: "...", image_url: "..."}]
    
    -- Media
    photo_url TEXT,
    source_url TEXT,  -- Original recipe URL if imported
    
    -- Nutrition (optional)
    nutrition JSONB,  -- {calories, protein, carbs, fat, fiber}
    
    -- Status
    is_favorite BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS
ALTER TABLE recipes ENABLE ROW LEVEL SECURITY;
CREATE POLICY recipes_tenant_isolation ON recipes
    USING (tenant_id = current_setting('app.tenant_id')::uuid);
```

### Recipe Ingredients

```sql
CREATE TABLE recipe_ingredients (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    recipe_id UUID NOT NULL REFERENCES recipes(id) ON DELETE CASCADE,
    
    -- Product link (optional)
    product_id UUID REFERENCES products(id),
    
    -- Ingredient details
    name VARCHAR(255) NOT NULL,  -- Display name
    quantity DECIMAL(10, 3) NOT NULL,
    quantity_unit VARCHAR(50) NOT NULL,  -- cups, tbsp, oz, grams
    
    -- Preparation
    preparation VARCHAR(100),  -- diced, minced, sliced
    
    -- Grouping
    group_name VARCHAR(100),  -- "For the sauce", "For the topping"
    sort_order INTEGER DEFAULT 0,
    
    -- Optional/substitutes
    is_optional BOOLEAN DEFAULT FALSE,
    substitute_for UUID REFERENCES recipe_ingredients(id)
);
```

### Meal Plans

```sql
CREATE TABLE meal_plans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    
    -- Date and meal
    plan_date DATE NOT NULL,
    meal_type VARCHAR(20) NOT NULL,  -- breakfast, lunch, dinner, snack
    
    -- What's planned
    recipe_id UUID REFERENCES recipes(id),
    custom_meal_name VARCHAR(255),  -- For non-recipe meals
    
    -- Servings (may differ from recipe default)
    servings INTEGER,
    
    -- Status
    status VARCHAR(20) DEFAULT 'planned',  -- planned, prepared, eaten, skipped
    
    -- People
    for_people UUID[],  -- Who this meal is for
    
    notes TEXT,
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    UNIQUE(tenant_id, plan_date, meal_type)
);

-- RLS
ALTER TABLE meal_plans ENABLE ROW LEVEL SECURITY;
CREATE POLICY meal_plans_tenant_isolation ON meal_plans
    USING (tenant_id = current_setting('app.tenant_id')::uuid);
```

---

## 70.11.3 Recipe UI

### Recipe List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Recipes                                [Search...] [+ Add Recipe]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Category: [All â–¼]  Cuisine: [All â–¼]  [â­ Favorites]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ [Photo]     â”‚  â”‚ [Photo]     â”‚  â”‚ [Photo]     â”‚              â”‚
â”‚  â”‚ Chicken     â”‚  â”‚ Pasta       â”‚  â”‚ Tacos       â”‚              â”‚
â”‚  â”‚ Stir Fry    â”‚  â”‚ Carbonara   â”‚  â”‚             â”‚              â”‚
â”‚  â”‚ â± 30 min    â”‚  â”‚ â± 45 min    â”‚  â”‚ â± 25 min    â”‚              â”‚
â”‚  â”‚ ğŸ½ 4 servingsâ”‚  â”‚ ğŸ½ 4 servingsâ”‚  â”‚ ğŸ½ 6 servingsâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ [Photo]     â”‚  â”‚ [Photo]     â”‚  â”‚ [Photo]     â”‚              â”‚
â”‚  â”‚ Salad       â”‚  â”‚ Soup        â”‚  â”‚ Pancakes    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Recipe Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chicken Stir Fry                              [Edit] [â­] [ğŸ“…] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    [Recipe Photo]                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â± 30 minutes  |  ğŸ½ [4 â–¼] servings  |  Category: Dinner        â”‚
â”‚                                                                  â”‚
â”‚  Can make: âœ… Yes (have all ingredients)           [Cook Now]   â”‚
â”‚                                                                  â”‚
â”‚  Ingredients                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  â–¡ 1 lb chicken breast, diced          âœ… In stock (2 lbs)     â”‚
â”‚  â–¡ 2 cups mixed vegetables             âœ… In stock              â”‚
â”‚  â–¡ 3 tbsp soy sauce                    âš ï¸ Low stock (1 tbsp)   â”‚
â”‚  â–¡ 1 tbsp sesame oil                   âœ… In stock              â”‚
â”‚  â–¡ 2 cloves garlic, minced             âœ… In stock              â”‚
â”‚                                                                  â”‚
â”‚  Instructions                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  1. Cut chicken into 1-inch cubes                               â”‚
â”‚  2. Heat oil in wok over high heat                              â”‚
â”‚  3. Add chicken, cook 5-6 minutes until golden                  â”‚
â”‚  4. Add vegetables, stir fry 3-4 minutes                        â”‚
â”‚  5. Add soy sauce and garlic, cook 1 minute                     â”‚
â”‚  6. Serve over rice                                             â”‚
â”‚                                                                  â”‚
â”‚                        [Add Missing to Shopping List]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.11.4 Meal Planning UI

### Week View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Meal Plan - Week of Feb 3, 2026            [< Prev] [Next >]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Mon      Tue      Wed      Thu      Fri      Sat    Sun  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŒ…    Pancakes  Cereal   Eggs     Cereal   Eggs    Waffles  -   â”‚
â”‚ ğŸŒ    Sandwich  Salad    Soup     Salad    -       -        -   â”‚
â”‚ ğŸŒ™    Stir Fry  Pasta    Tacos    Pizza    [+]     [+]      [+] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend: ğŸŒ… Breakfast  ğŸŒ Lunch  ğŸŒ™ Dinner
Green = Have ingredients  Yellow = Missing some  [+] = Empty slot
```

### Add to Meal Plan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add to Meal Plan                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Date: [Monday, Feb 3 â–¼]       Meal: [Dinner â–¼]                 â”‚
â”‚                                                                  â”‚
â”‚  Recipe: [Search recipes...                                  ğŸ”]â”‚
â”‚                                                                  â”‚
â”‚  Suggestions based on inventory:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ… Chicken Stir Fry - have all ingredients                â”‚  â”‚
â”‚  â”‚ âœ… Pasta Carbonara - have all ingredients                 â”‚  â”‚
â”‚  â”‚ âš ï¸ Tacos - missing: salsa, sour cream                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Servings: [4]  (Recipe default: 4)                             â”‚
â”‚                                                                  â”‚
â”‚  For: [âœ“] Alex  [âœ“] Jordan  [ ] Sam (vegetarian)               â”‚
â”‚                                                                  â”‚
â”‚                                              [Cancel] [Add]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70.11.5 Inventory Check

### "What Can I Make?"

```python
async def get_cookable_recipes(tenant_id: UUID, db: Session) -> list[CookableRecipe]:
    """Find recipes that can be made with current inventory."""
    
    recipes = db.query(Recipe).filter(
        Recipe.tenant_id == tenant_id,
        Recipe.is_active == True
    ).all()
    
    results = []
    for recipe in recipes:
        ingredients = recipe.ingredients
        
        available = 0
        missing = []
        
        for ing in ingredients:
            if ing.product_id:
                stock = get_product_stock(ing.product_id, tenant_id)
                if stock >= ing.quantity:
                    available += 1
                else:
                    missing.append({
                        "ingredient": ing.name,
                        "needed": ing.quantity,
                        "have": stock
                    })
            else:
                # Unlinked ingredient, assume available
                available += 1
        
        results.append(CookableRecipe(
            recipe=recipe,
            can_make=len(missing) == 0,
            ingredients_available=available,
            ingredients_total=len(ingredients),
            missing_ingredients=missing
        ))
    
    # Sort by completeness
    results.sort(key=lambda r: (-r.ingredients_available, len(r.missing_ingredients)))
    return results
```

---

## 70.11.6 API Endpoints

### Create Recipe

```http
POST /api/v2/recipes
Content-Type: application/json

{
  "name": "Chicken Stir Fry",
  "category": "dinner",
  "cuisine": "asian",
  "prep_time_minutes": 15,
  "cook_time_minutes": 15,
  "servings": 4,
  "ingredients": [
    {
      "name": "chicken breast",
      "product_id": "...",
      "quantity": 1,
      "quantity_unit": "lb",
      "preparation": "diced"
    }
  ],
  "instructions": [
    { "step": 1, "text": "Cut chicken into 1-inch cubes" }
  ]
}
```

### Plan Meal

```http
POST /api/v2/meal-plans
Content-Type: application/json

{
  "plan_date": "2026-02-03",
  "meal_type": "dinner",
  "recipe_id": "...",
  "servings": 4,
  "for_people": ["...", "..."]
}
```

### Get Week Plan

```http
GET /api/v2/meal-plans?from=2026-02-03&to=2026-02-09

Response:
{
  "plans": [
    {
      "date": "2026-02-03",
      "breakfast": { "recipe": "Pancakes", "can_make": true },
      "lunch": { "recipe": "Sandwich", "can_make": true },
      "dinner": { "recipe": "Chicken Stir Fry", "can_make": false, "missing": ["soy sauce"] }
    }
  ]
}
```

### What Can I Make?

```http
GET /api/v2/recipes/cookable

Response:
{
  "recipes": [
    {
      "id": "...",
      "name": "Chicken Stir Fry",
      "can_make": true,
      "available": 5,
      "total": 5
    },
    {
      "id": "...",
      "name": "Tacos",
      "can_make": false,
      "available": 4,
      "total": 6,
      "missing": ["salsa", "sour cream"]
    }
  ]
}
```

---

## 70.11.7 Recipe Import

### From URL (Future)

```python
async def import_recipe_from_url(url: str) -> Recipe:
    """Import recipe from popular recipe sites."""
    
    # Fetch page
    html = await fetch_url(url)
    
    # Try to find schema.org Recipe markup
    recipe_data = extract_schema_recipe(html)
    
    if not recipe_data:
        # Fall back to LLM extraction
        recipe_data = await llm_extract_recipe(html)
    
    return Recipe(
        name=recipe_data["name"],
        ingredients=parse_ingredients(recipe_data["ingredients"]),
        instructions=parse_instructions(recipe_data["instructions"]),
        source_url=url
    )
```

---

## 70.11.8 User Stories

| ID | Story | Priority |
|----|-------|----------|
| US-RCP-01 | As a user, I want to store my recipes with ingredients | [CRITICAL] |
| US-RCP-02 | As a user, I want to plan meals on a calendar | [CRITICAL] |
| US-RCP-03 | As a user, I want to see what recipes I can make with current inventory | [CORE] |
| US-RCP-04 | As a user, I want to scale recipes to different serving sizes | [CORE] |
| US-RCP-05 | As a user, I want to add missing ingredients to my shopping list | [CORE] |
| US-RCP-06 | As a user, I want to import recipes from websites | [FUTURE] |

---

## Navigation

- **Previous:** [People & Consumption](70.10-people-consumption.md)
- **Next:** [Shopping Lists](70.12-shopping-lists.md)
- **Back to:** [README](README.md)
